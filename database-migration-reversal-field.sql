-- ============================================
-- ğŸ“‹ æ•°æ®åº“è¿ç§»è„šæœ¬ï¼šæ·»åŠ å›æ»šè¿½è¸ªå­—æ®µ
-- ============================================
-- ä½œç”¨ï¼šä¸º stock_transactions è¡¨æ·»åŠ  reversal_of å­—æ®µ
-- ç”¨é€”ï¼šè¿½è¸ªåº“å­˜å›æ»šæ“ä½œçš„åŸå§‹äº¤æ˜“è®°å½•
-- æ—¥æœŸï¼š2025-12-22
-- ============================================

-- ğŸ”§ æ­¥éª¤ 1: æ·»åŠ  reversal_of å­—æ®µï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
ALTER TABLE stock_transactions 
ADD COLUMN IF NOT EXISTS reversal_of uuid;

-- ğŸ“ æ­¥éª¤ 2: æ·»åŠ å­—æ®µæ³¨é‡Š
COMMENT ON COLUMN stock_transactions.reversal_of IS 'å›æ»šçš„åŸäº¤æ˜“IDï¼ˆç”¨äºè¿½è¸ªå›æ»šå…³ç³»ï¼‰';

-- ğŸ”— æ­¥éª¤ 3: åˆ›å»ºç´¢å¼•ä»¥æå‡æŸ¥è¯¢æ€§èƒ½
CREATE INDEX IF NOT EXISTS idx_stock_transactions_reversal_of 
ON stock_transactions(reversal_of);

-- âœ… å®Œæˆï¼ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨å›æ»šåŠŸèƒ½äº†

-- ============================================
-- ğŸ“Œ ä½¿ç”¨è¯´æ˜ï¼š
-- ============================================
-- 1. ç™»å½• Supabase Dashboard
-- 2. è¿›å…¥ä½ çš„é¡¹ç›®
-- 3. ç‚¹å‡»å·¦ä¾§èœå• "SQL Editor"
-- 4. åˆ›å»ºæ–°æŸ¥è¯¢
-- 5. å¤åˆ¶ç²˜è´´æœ¬è„šæœ¬çš„å…¨éƒ¨å†…å®¹
-- 6. ç‚¹å‡» "Run" æ‰§è¡Œ
-- 7. çœ‹åˆ° "Success. No rows returned" è¡¨ç¤ºæˆåŠŸ
-- ============================================

-- ============================================
-- ğŸ§ª æµ‹è¯•æŸ¥è¯¢ï¼šéªŒè¯å­—æ®µæ˜¯å¦æ·»åŠ æˆåŠŸ
-- ============================================
-- å–æ¶ˆæ³¨é‡Šä¸‹é¢è¿™è¡Œæ¥æµ‹è¯•ï¼š
-- SELECT column_name, data_type, is_nullable 
-- FROM information_schema.columns 
-- WHERE table_name = 'stock_transactions' AND column_name = 'reversal_of';
